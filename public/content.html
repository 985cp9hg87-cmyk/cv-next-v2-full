<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="theme-color" content="#0b1321"/>
  <title>Jos√© Luis Acevedo Ayala ¬∑ Ingeniero Comercial</title>
  <style>
    /* ==== Tema: Royal Sapphire ==== */
    :root{
      --bg:#0b1321; --panel:#0f172a; --panel-2:#0a1323; --text:#f8fafc; --muted:#cbd5e1;
      --brand1:#0ea5e9; /* sw1 */
      --brand2:#22d3ee; /* sw2 */
      --stroke:rgba(14,165,233,.35);
      --shadow:0 22px 60px rgba(0,0,0,.45); --radius:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:
        radial-gradient(900px 380px at 10% -5%, rgba(14,165,233,.10), transparent 60%),
        radial-gradient(800px 340px at 110% 0%, rgba(34,211,238,.10), transparent 60%),
        linear-gradient(180deg, #0b1321 0%, #0e172b 40%, #0a1323 100%);
      color:var(--text);
      font:16px/1.65 -apple-system, system-ui, Segoe UI, Inter, Roboto, Helvetica, Arial, sans-serif;
    }
    .wrap{ width:min(1180px, 92vw); margin:auto; padding:36px 0 90px; }
    .grid{ display:grid; grid-template-columns: 540px 1fr; gap:28px; }

    /* HERO */
    header.hero{
      display:grid;
      grid-template-columns: 180px 1fr;
      gap:20px;
      align-items:center;
      margin-bottom:22px;
    }
    .avatar{
      width:180px; height:180px; border-radius:14px;
      background:linear-gradient(180deg,#0b1220,#0f1a2a);
      border:1px solid var(--stroke); box-shadow:var(--shadow); overflow:hidden;
    }
    .avatar img{ width:100%; height:100%; display:block; object-fit:cover; object-position:center 24% }
    .title{ min-width:0; }
    .title h1{ margin:0; font:800 45px/1.04 ui-serif, Georgia, 'Times New Roman', serif; letter-spacing:.2px; }
    .title h1 span{ display:inline; }
    .title h1 span + span::before{ content:" "; }
    .subtitle{ margin-top:0px; color:var(--brand1); font-weight:700; letter-spacing:.3px; font-size:35px; }

    .section-title{ font:800 28px/1.2 ui-serif, Georgia, serif; margin:0 0 12px }
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid var(--stroke); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:18px;
    }
    .kicker{ color:var(--muted); text-align:left; }
    .cards{ display:flex; flex-direction:column; gap:14px }
    .card{
      display:flex; align-items:center; gap:14px; padding:14px; border-radius:16px;
      background:rgba(255,255,255,.02); border:1px solid var(--stroke);
    }
    .badge{
      width:38px; height:38px; border-radius:10px; display:grid; place-items:center;
      background:linear-gradient(180deg, rgba(14,165,233,.18), rgba(34,211,238,.10));
      border:1px solid rgba(14,165,233,.60); color:#08222b; font-weight:800;
    }
    .card h4{ margin:0; font-weight:800 }
    .card p{ margin:2px 0 0; color:var(--muted) }

    .skills{ columns:2; column-gap:18px }
    .skills li{ break-inside:avoid; margin:8px 0; list-style:none; padding-left:26px; position:relative }
    .skills li:before{ content:"‚Ä¢"; position:absolute; left:8px; color:var(--brand2) }

    .contact li{ list-style:none; margin:10px 0; display:flex; gap:10px; align-items:center }
    .contact li svg{ opacity:.9 }
    a{ color:var(--brand2) }

    .cta-box .btn{
      display:block; width:100%; text-align:center; padding:14px 16px; border-radius:12px; margin:10px 0;
      font-weight:800; text-decoration:none; color:#07131a;
      background:linear-gradient(180deg, var(--brand1), var(--brand2));
      border:1px solid rgba(14,165,233,.65);
    }
    .btn.secondary{
      background:transparent; color:var(--text);
      border:1px solid rgba(14,165,233,.55)
    }

    .xp h3{ margin:0 0 2px; font-weight:900 }
    .meta{ color:var(--muted); margin:0 0 8px }
    .bullets{ margin:0 0 0 20px } .bullets li{ margin:6px 0 }

    /* details */
    details.xp-item{
      background:rgba(255,255,255,.02);
      border:1px solid var(--stroke);
      border-radius:14px; padding:14px; margin:12px 0;
    }
    details.xp-item summary{ list-style:none; cursor:pointer; outline:none; display:flex; align-items:center; gap:10px; }
    details.xp-item summary::-webkit-details-marker{display:none}
    .chev{width:18px;height:18px;display:inline-block;transform:rotate(-90deg);transition:.2s}
    details[open] .chev{transform:rotate(0deg)}

    @media (min-width:1001px){
      .avatar{ transform: translateX(0px); }
      details.xp-item{ border:none; background:transparent; padding:0; margin:16px 0; }
      details.xp-item summary{ pointer-events:none; cursor:default; padding:0; }
      .chev{ display:none !important; }
      details.xp-item[open] .bullets{ display:block; }
    }
    @media (max-width:1000px){
      .grid{ grid-template-columns:1fr }
      .panel{ padding:16px }
      .skills{ columns:1 }
      .avatar{ transform:none !important; }
    }
    @media (max-width:700px){
      header.hero{ grid-template-columns: 128px 1fr; gap: 12px; align-items: center; }
      .avatar{ width:128px; height:128px; border-radius:12px; }
      .avatar img{ object-position: 50% 26%; }
      .title{ margin-left: 8px; transform: translateX(4px); }
      .title h1{ font-size: clamp(26px, 6vw, 32px); line-height: 1.1; margin: 0; }
      .title h1 span{ display:block; }
      .subtitle{ font-size: clamp(13px, 3.6vw, 15px); margin-top: 6px; }
      .wrap{ padding-left:12px; padding-right:12px; }
    }
    figure{ margin:0; }

    /* ========= MODAL (se mantiene por si lo usas despu√©s) ========= */
    .modal{ position:fixed; inset:0; display:none; place-items:center; z-index:9999; background:rgba(0,0,0,.65) }
    .modal.open{ display:grid; }
    .modal-card{
      width:min(560px, 92vw);
      background:linear-gradient(180deg, var(--panel), var(--panel-2));
      border:1px solid var(--stroke);
      border-radius:16px; box-shadow:var(--shadow);
      padding:18px; position:relative; color:var(--text);
    }
    .modal-card h3{ margin:0 0 8px; font: 800 22px/1.2 ui-serif, Georgia, serif; }
    .modal-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .modal-grid .full{ grid-column:1/-1; }
    .field{ position:relative; }
    .field label{ display:block; font-size:14px; color:var(--muted); margin-bottom:4px; }
    .field input, .field select, .field textarea{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--stroke);
      background:#0b1220; color:var(--text); outline:none;
    }

    .modal-actions{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:12px; align-items:stretch;
    }
    @media (min-width:520px){ .modal-actions{ grid-template-columns: repeat(4, 1fr); } }
    .btn.small{
      padding:12px 14px; border-radius:12px; font-weight:800; text-align:center;
      border:1px solid rgba(14,165,233,.6);
      background:linear-gradient(180deg, var(--brand1), var(--brand2));
      color:#07131a; text-decoration:none; display:inline-block;
    }
    .btn.ghost{ background:transparent; color:var(--text); border:1px solid rgba(14,165,233,.5) }
    .btn[disabled]{ opacity:.55; filter:grayscale(.2); cursor:not-allowed; }

    .helper{ color:var(--muted); font-size:12px; margin-top:8px; }
    .close-x{ position:absolute; right:14px; top:10px; cursor:pointer; opacity:.8 }

    /* Time dropdown */
    .time-dropdown{
      position:absolute; left:0; right:0; top:calc(100% + 6px);
      background:#0b1220; border:1px solid var(--stroke); border-radius:12px;
      max-height:220px; overflow:auto; box-shadow:var(--shadow);
      display:none; z-index:10000;
    }
    .time-dropdown.open{ display:block; }
    .time-option{ padding:10px 12px; cursor:pointer; user-select:none; border-bottom:1px solid rgba(255,255,255,.04); }
    .time-option:last-child{ border-bottom:none; }
    .time-option:hover{ background:rgba(255,255,255,.06); }
    .time-empty{ padding:10px 12px; color:var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- HERO -->
    <header class="hero">
      <figure class="avatar">
        <img src="assets/foto.jpg" alt="Foto de Jos√© Luis Acevedo Ayala" loading="lazy" />
      </figure>
      <div class="title">
        <h1><span>Jos√© Luis Acevedo</span><span>Ayala</span></h1>
        <div class="subtitle">Ingeniero Comercial</div>
      </div>
    </header>

    <main class="grid">
      <!-- Columna izquierda -->
      <section class="panel">
        <h2 class="section-title">Sobre m√≠</h2>
        <p class="kicker">
          La gesti√≥n comercial es una orquesta compleja: cada equipo, proveedor y herramienta es un instrumento que debe sonar en armon√≠a. En mi experiencia liderando operaciones, he implementado automatizaciones low-code/no-code que sincronizan procesos y evitan errores o retrasos. Lider√© proyectos para integrar flujos de trabajo de ventas y log√≠stica, logrando que la eficiencia operativa se traduzca en mayor calidad de servicio. Este enfoque creativo y orientado a soluciones me convierte en un profesional capaz de transformar retos administrativos en resultados tangibles, conectando equipos y tecnolog√≠a.
        </p>
      </section>

      <section class="panel">
        <h2 class="section-title">Experiencia Laboral</h2>
        <div class="cards">
          <div class="card">
            <div class="badge">po</div>
            <div>
              <h4>Procomercial.com</h4>
              <p>Jefatura de administraci√≥n ¬∑ Comercializadora de bienes ra√≠ces ¬∑ <strong>2 a√±os</strong></p>
            </div>
          </div>
          <div class="card">
            <div class="badge">im</div>
            <div>
              <h4>In-Store Media</h4>
              <p>Jefatura de operaciones ¬∑ Agencia de medios publicitarios ¬∑ <strong>7 a√±os</strong></p>
            </div>
          </div>
          <div class="card">
            <div class="badge">ecr</div>
            <div>
              <h4>ECR Group Complementos Recourse</h4>
              <p>Ejecutivo de cuenta ¬∑ Outsourcing RRHH ¬∑ <strong>5 a√±os</strong></p>
            </div>
          </div>
        </div>
      </section>

      <!-- EDUCACI√ìN -->
      <section class="panel">
        <h2 class="section-title">Educaci√≥n</h2>
        <div class="cards">
          <div class="card">
            <div class="badge">üéì</div>
            <div>
              <h4>Diplomado en Marketing Digital</h4>
              <p>Pontificia Universidad Cat√≥lica de Chile ‚Äî <strong>2022</strong></p>
            </div>
          </div>
          <div class="card">
            <div class="badge">üéì</div>
            <div>
              <h4>Mag√≠ster en Administraci√≥n de Empresas</h4>
              <p>Universidad Gabriela Mistral ‚Äî <strong>2012</strong></p>
            </div>
          </div>
          <div class="card">
            <div class="badge">üéì</div>
            <div>
              <h4>Ingenier√≠a Comercial</h4>
              <p>Universidad Gabriela Mistral ‚Äî <strong>2005</strong></p>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2 class="section-title">Habilidades</h2>
        <ul class="skills">
          <li>Planificaci√≥n estrat√©gica</li><li>Gesti√≥n de equipos</li><li>Dise√±o de procesos</li>
          <li>Resoluci√≥n de conflictos</li><li>Coordinaci√≥n inter√°reas</li><li>Gesti√≥n financiera</li>
          <li>Redes colaborativas</li><li>Adaptabilidad y liderazgo</li>
        </ul>
      </section>

      <section class="panel">
        <h2 class="section-title">Contacto</h2>
        <ul class="contact">
          <li>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 4h16v16H4z"/><path d="M22 6l-10 7L2 6"/></svg>
            <a href="mailto:a.joseluis.w@gmail.com">a.joseluis.w@gmail.com</a>
          </li>
          <li>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M22 16.92V19a2 2 0 0 1-2.18 2A19.79 19.79 0 0 1 3 5.18 2 2 0 0 1 5 3h2.09a2 2 0 0 1 2 1.72c.12.81.3 1.6.57 2.34a2 2 0 0 1-.45 2.11L8.09 10a16 16 0 0 0 6.82 6.82l.83-1.12a2 2 0 0 1 2.11-.45c.74 .27 1.53 .45 2.34 .57a2 2 0 0 1 1.72 2z"/></svg>
            <a href="tel:+56922008319">+56 9 22008319</a>
          </li>
          <li>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 10v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10"/><path d="M7 10V5a5 5 0 0 1 10 0v5"/></svg>
            Loreto 275, depto. 100B, Santiago
          </li>
        </ul>
        <div class="cta-box" style="margin-top:8px">
          <a class="btn" data-cta="email" href="mailto:a.joseluis.w@gmail.com">Enviar correo</a>
          <a class="btn secondary" data-cta="wsp" href="https://wa.me/56922008319?text=Hola%20Jos%C3%A9%20Luis%2C%20vi%20tu%20CV%20y%20me%20gustar%C3%ADa%20agendar%20una%20entrevista." target="_blank" rel="noopener">Enviar WhatsApp</a>
          <a class="btn secondary" data-cta="agenda" href="#agenda" id="btnAgenda">Agendar entrevista</a>
        </div>
      </section>

      <!-- Experiencia (detalle) -->
      <section class="panel xp" style="grid-column:1 / -1;">
        <h2 class="section-title">Experiencia (detalle)</h2>

        <details class="xp-item">
          <summary>
            <span class="chev">‚ñ∂</span>
            <div>
              <h3>Procomercial.com ‚Äî Jefatura de administraci√≥n</h3>
              <div class="meta">Comercializadora de bienes ra√≠ces ¬∑ <strong>2 a√±os</strong></div>
            </div>
          </summary>
          <ul class="bullets">
            <li>Gesti√≥n integral del ciclo administrativo-financiero (liquidez, normativa, eficiencia).</li>
            <li>Dise√±o y gesti√≥n de flujos de caja mensuales; proyecci√≥n de ingresos/egresos.</li>
            <li>Registro contable; conciliaciones bancarias peri√≥dicas.</li>
            <li>Cobranza, proveedores, facturaci√≥n y control documental.</li>
            <li>Operaciones de factoring para capital de trabajo.</li>
            <li>Coordinaci√≥n con contabilidad externa (remuneraciones, contratos, F29, balances y renta).</li>
          </ul>
        </details>

        <details class="xp-item">
          <summary>
            <span class="chev">‚ñ∂</span>
            <div>
              <h3>In-Store Media ‚Äî Jefatura de operaciones</h3>
              <div class="meta">Agencia de medios publicitarios ¬∑ <strong>7 a√±os</strong></div>
            </div>
          </summary>
          <ul class="bullets">
            <li>Coordinaci√≥n y supervisi√≥n de equipos a nivel nacional en centros comerciales y supermercados.</li>
            <li>Red de proveedores publicitarios; negociaci√≥n y supervisi√≥n de cumplimiento.</li>
            <li>Planificaci√≥n, autorizaci√≥n y ejecuci√≥n de proyectos publicitarios.</li>
            <li>Operaciones log√≠sticas complejas (incl. horarios nocturnos).</li>
            <li>Soporte a finanzas: facturaci√≥n, cr√©dito y pagos.</li>
            <li>Reportes de gesti√≥n y presupuesto anual de operaciones.</li>
          </ul>
        </details>

        <details class="xp-item">
          <summary>
            <span class="chev">‚ñ∂</span>
            <div>
              <h3>ECR Group Complementos Recourse ‚Äî Ejecutivo de cuenta</h3>
              <div class="meta">Outsourcing de RRHH ¬∑ <strong>5 a√±os</strong></div>
            </div>
          </summary>
          <ul class="bullets">
            <li>Coordinaci√≥n de equipos en retail a nivel nacional; est√°ndares de stock e imagen.</li>
            <li>Optimizaci√≥n de rutas y cobertura de puntos de venta.</li>
            <li>Reclutamiento, selecci√≥n y capacitaci√≥n operativa.</li>
            <li>Procesos administrativos con RRHH (contratos, licencias, finiquitos).</li>
            <li>Informes de remuneraciones y gastos para facturaci√≥n y cobranza.</li>
          </ul>
        </details>
      </section>
    </main>
  </div>

  <!-- ===== Modal Agendar (conservado) ===== -->
  <div class="modal" id="agendaModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="agendaTitle">
      <div class="close-x" id="closeAgenda" title="Cerrar">‚úï</div>
      <h3 id="agendaTitle">Agendar entrevista</h3>
      <div class="modal-grid">
        <div class="field">
          <label for="agName">Tu nombre</label>
          <input id="agName" type="text" placeholder="Ej: Carla Soto">
        </div>
        <div class="field">
          <label for="agCompany">Empresa (opcional)</label>
          <input id="agCompany" type="text" placeholder="Ej: Retail Chile">
        </div>
        <div class="field">
          <label for="agDate">Fecha</label>
          <input id="agDate" type="date">
        </div>
        <div class="field" id="timeField">
          <label for="agTime">Hora</label>
          <input id="agTime" type="text" placeholder="HH:MM" readonly>
          <div id="timeDropdown" class="time-dropdown" aria-hidden="true"></div>
        </div>
        <div class="field">
          <label for="agDuration">Duraci√≥n</label>
          <select id="agDuration">
            <option value="30">30 min</option>
            <option value="45">45 min</option>
            <option value="60" selected>60 min</option>
          </select>
        </div>
        <div class="field">
          <label for="agMode">Modalidad</label>
          <select id="agMode">
            <option>Videollamada</option>
            <option>Telef√≥nica</option>
            <option>Presencial</option>
          </select>
        </div>
        <div class="field full">
          <label for="agNotes">Mensaje (opcional)</label>
          <textarea id="agNotes" rows="3" placeholder="Ej: Tema principal, contexto del cargo, etc."></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <a id="linkWhatsApp" class="btn small" target="_blank" rel="noopener">WhatsApp</a>
        <a id="linkEmail" class="btn small">Enviar correo</a>
        <a id="linkGCal" class="btn small" target="_blank" rel="noopener">Agendar en Google Calendar</a>
        <a id="linkICS" class="btn small ghost" download="Entrevista-con-Jos√©-Luis-Acevedo.ics">Descargar .ics</a>
        <button id="closeBtn" class="btn small ghost" type="button">Cerrar</button>
      </div>
      <div class="helper">La hora se toma seg√∫n tu zona horaria de dispositivo.</div>
    </div>
  </div>

  <script>
    /* ===== Acorde√≥n solo en m√≥vil ===== */
    function setAccordionState(){
      const isDesktop = window.matchMedia("(min-width:1001px)").matches;
      document.querySelectorAll("details.xp-item").forEach(d => {
        if (isDesktop) d.setAttribute("open", "");
        else d.removeAttribute("open");
      });
    }
    document.addEventListener("click", (e) => {
      if (window.matchMedia("(min-width:1001px)").matches) {
        const sum = e.target.closest("details.xp-item > summary");
        if (sum) e.preventDefault();
      }
    });
    window.addEventListener("resize", setAccordionState);
    window.addEventListener("DOMContentLoaded", setAccordionState);

    /* ===== Utils fechas ===== */
    const pad = n => String(n).padStart(2,'0');
    const toYMD = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    function formatICSDate(d){
      return d.getFullYear() + pad(d.getMonth()+1) + pad(d.getDate()) +
             'T' + pad(d.getHours()) + pad(d.getMinutes()) + pad(d.getSeconds());
    }
    function formatGCalDate(d){ return formatICSDate(d); }

    /* ===== H√°biles ===== */
    function nextBusinessDayDate(base = new Date()){
      const d = new Date(base.getFullYear(), base.getMonth(), base.getDate());
      do { d.setDate(d.getDate() + 1); } while (d.getDay() === 0 || d.getDay() === 6);
      return d;
    }
    function nextBusinessDayStr(base = new Date()){ return toYMD(nextBusinessDayDate(base)); }
    function nextOrSameBusinessDayStr(dateObj){
      const d = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate());
      if (d.getDay() === 6) d.setDate(d.getDate() + 2);
      if (d.getDay() === 0) d.setDate(d.getDate() + 1);
      return toYMD(d);
    }

    const agDate = document.getElementById('agDate');
    function updateBusinessDateLimits(){
      const minStr = nextBusinessDayStr(new Date());
      agDate.min = minStr;
      agDate.removeAttribute('max');
      if (!agDate.value || agDate.value < minStr) agDate.value = minStr;
      else {
        const chosen = new Date(agDate.value + 'T00:00:00');
        if (chosen.getDay() === 0 || chosen.getDay() === 6) {
          const adj = nextOrSameBusinessDayStr(chosen);
          agDate.value = (adj < minStr) ? minStr : adj;
        }
      }
    }
    updateBusinessDateLimits();
    setInterval(updateBusinessDateLimits, 60*1000);

    /* ===== Selector de hora ===== */
    const agTimeInput = document.getElementById('agTime');
    const timeDropdown = document.getElementById('timeDropdown');
    const timeField = document.getElementById('timeField');
    function minutes(h, m){ return h*60 + m; }
    function label(h, m){ return `${pad(h)}:${pad(m)}`; }
    function generateSlots(dateStr){
      const slots = [];
      if(!dateStr) return slots;
      const d = new Date(dateStr + 'T00:00:00');
      const isThu = d.getDay() === 4; // jueves
      const blocks = [
        {from: minutes(9,0), to: minutes(13,0)},
        ...(isThu ? [] : [{from: minutes(14,0), to: minutes(18,0)}])
      ];
      for(const b of blocks){
        for(let m=b.from; m<=b.to; m+=30){
          const h = Math.floor(m/60), mm = m%60;
          slots.push(label(h, mm));
        }
      }
      return slots;
    }
    function renderTimeDropdown(){
      const date = agDate.value || nextBusinessDayStr();
      const options = generateSlots(date);
      timeDropdown.innerHTML = '';
      if(options.length === 0){
        timeDropdown.innerHTML = `<div class="time-empty">No hay horarios disponibles para la fecha seleccionada.</div>`;
        return;
      }
      options.forEach(t => {
        const div = document.createElement('div');
        div.className = 'time-option';
        div.textContent = t;
        div.addEventListener('click', ()=>{
          agTimeInput.value = t;
          closeTimeDropdown();
          buildAllLinks();
        });
        timeDropdown.appendChild(div);
      });
    }
    function openTimeDropdown(){
      if(!agDate.value) updateBusinessDateLimits();
      renderTimeDropdown();
      timeDropdown.classList.add('open');
      timeDropdown.setAttribute('aria-hidden','false');
    }
    function closeTimeDropdown(){
      timeDropdown.classList.remove('open');
      timeDropdown.setAttribute('aria-hidden','true');
    }
    agTimeInput.addEventListener('click', (e)=>{ e.stopPropagation(); openTimeDropdown(); });
    agTimeInput.addEventListener('focus', ()=> openTimeDropdown());
    document.addEventListener('click', (e)=>{ if(!timeField.contains(e.target)) closeTimeDropdown(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeTimeDropdown(); });

    agDate.addEventListener('change', ()=>{
      const minStr = agDate.min || nextBusinessDayStr();
      let val = agDate.value || minStr;
      if (val < minStr) val = minStr;
      const d = new Date(val + 'T00:00:00');
      const adjusted = (d.getDay()===0 || d.getDay()===6) ? nextOrSameBusinessDayStr(d) : val;
      if (adjusted !== agDate.value) agDate.value = adjusted;
      if(timeDropdown.classList.contains('open')) renderTimeDropdown();
      if (!agTimeInput.value) {
        const opts = generateSlots(agDate.value);
        agTimeInput.value = opts[0] || '';
      }
      buildAllLinks();
    });

    /* ===== Enlaces de la agenda en el modal (por si lo usas m√°s adelante) ===== */
    function buildAllLinks(){
      const name = document.getElementById('agName').value.trim();
      const company = document.getElementById('agCompany').value.trim();
      const date = document.getElementById('agDate').value || nextBusinessDayStr();
      const time = document.getElementById('agTime').value;
      const duration = parseInt(document.getElementById('agDuration').value, 10) || 60;
      const mode = document.getElementById('agMode').value;
      const notes = document.getElementById('agNotes').value.trim();
      if(!date || !time){ return; }

      const start = new Date(date + 'T' + time);
      const end = new Date(start.getTime() + duration * 60000);

      const title = 'Entrevista con Jos√© Luis Acevedo';
      let details = 'Reuni√≥n de entrevista';
      if(name) details += ' ‚Äî Contacto: ' + name;
      if(company) details += ' (' + company + ')';
      details += '. Modalidad: ' + mode + '.';
      if(notes) details += '\\n\\nNotas: ' + notes;

      // WhatsApp
      const human = start.toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' });
      const waMsg =
        `Hola Jos√© Luis, me gustar√≠a agendar una entrevista el ${human} (${duration} min, ${mode}).` +
        (name ? `%0AContacto: ${encodeURIComponent(name)}` : '') +
        (company ? `%0AEmpresa: ${encodeURIComponent(company)}` : '') +
        (notes ? `%0ANotas: ${encodeURIComponent(notes)}` : '');
      document.getElementById('linkWhatsApp').href =
        'https://wa.me/56922008319?text=' + waMsg;

      // Email
      const subject = encodeURIComponent(title);
      const body =
        `Hola Jos√© Luis,%0A%0A` +
        `¬øPodemos agendar el ${encodeURIComponent(human)} (${duration} min, ${encodeURIComponent(mode)})?%0A` +
        (name ? `Contacto: ${encodeURIComponent(name)}%0A` : '') +
        (company ? `Empresa: ${encodeURIComponent(company)}%0A` : '') +
        (notes ? `Notas: ${encodeURIComponent(notes)}%0A` : '') +
        `%0AGracias.`;
      document.getElementById('linkEmail').href =
        `mailto:a.joseluis.w@gmail.com?subject=${subject}&body=${body}`;

      // Google Calendar (plantilla)
      const gcDetails = encodeURIComponent(details);
      const gcDates = formatGCalDate(start) + '/' + formatGCalDate(end);
      document.getElementById('linkGCal').href =
        `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${gcDates}&details=${gcDetails}`;

      // ICS
      const uid = Date.now() + '@joseluisacevedo.site';
      const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-/JLAA/Agenda/ES
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${formatICSDate(new Date())}
DTSTART:${formatICSDate(start)}
DTEND:${formatICSDate(end)}
SUMMARY:${title}
DESCRIPTION:${details.replace(/\\n/g,'\\\\n')}
END:VEVENT
END:VCALENDAR`;
      const icsBlob = new Blob([ics], {type:'text/calendar'});
      document.getElementById('linkICS').href = URL.createObjectURL(icsBlob);
    }

    // ===== CTA: abrir reservas de Google =====
    const modal = document.getElementById('agendaModal');
    const openBtn = document.getElementById('btnAgenda');
    const closeBtn = document.getElementById('closeBtn');
    const closeX = document.getElementById('closeAgenda');

    // Reemplaza por TU URL p√∫blica de "Google Citas/Reservas"
    const BOOKING_URL = 'https://calendar.app.google/SCCEWz7QwmmgxLsB7';

    function openModal(e){
      if(e) e.preventDefault();
      window.open(BOOKING_URL, '_blank', 'noopener');
    }
    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      const timeDropdown = document.getElementById('timeDropdown');
      if (timeDropdown) timeDropdown.classList.remove('open');
    }
    openBtn.addEventListener('click', openModal);
    if(closeBtn) closeBtn.addEventListener('click', closeModal);
    if(closeX) closeX.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

    ['agName','agCompany','agDate','agTime','agDuration','agMode','agNotes'].forEach(id=>{
      const el = document.getElementById(id);
      if (el){
        el.addEventListener('input', buildAllLinks);
        el.addEventListener('change', buildAllLinks);
      }
    });

    // ===== Helper para enviar eventos a /api/track =====
    function sendTrackingEvent(extra) {
      try {
        const url = new URL(window.location.href);
        const params = url.searchParams;

        const payload = {
          path: window.location.pathname,
          referrer: document.referrer || null,
          utm_source: params.get('utm_source') || null,
          utm_medium: params.get('utm_medium') || null,
          utm_campaign: params.get('utm_campaign') || null,
          ...extra,
        };

        // Preferir sendBeacon para no perder eventos en navegaci√≥n
        if (navigator && navigator.sendBeacon) {
          try {
            const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
            navigator.sendBeacon('/api/track', blob);
            return;
          } catch (e) {
            // si falla sendBeacon, caeremos a fetch
          }
        }

        // fetch con keepalive ayuda en navegaciones r√°pidas
        fetch('/api/track', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
          keepalive: true,
          credentials: 'same-origin'
        }).catch(() => {
          // silencioso
        });
      } catch (e) {
        // no hacer nada si algo raro pasa con la URL
      }
    }

    // ===== Pageview al cargar =====
    window.addEventListener('load', function () {
      sendTrackingEvent({ type: 'pageview' });
    });

    // ===== Clicks en CTAs (elementos con data-cta) =====
    document.addEventListener('click', function (event) {
      var el = event.target;
      // sube en el DOM hasta encontrar un elemento con data-cta
      while (el && el !== document.body) {
        if (el.hasAttribute && el.hasAttribute('data-cta')) {
          var label = el.getAttribute('data-cta') || (el.textContent || '').trim() || 'cta';
          sendTrackingEvent({
            type: 'cta_click',
            label: label,
          });
          break;
        }
        el = el.parentElement;
      }
    });
  </script>
</body>
</html>